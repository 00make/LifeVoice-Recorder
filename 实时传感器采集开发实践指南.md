# Context Node 开发实践指南

本指南指导如何构建低功耗、高精度的 Context Provider。

## 1. 核心依赖

- **Google location** (FusedLocationProviderClient).
- **Google activity-recognition** (Activity Recognition Transition API).
- **Health Connect API** (读取手表健康数据).

## 2. 数据结构定义 (The Context JSON)

```json
{
  "timestamp": 1709823423000,
  "user_state": {
    "activity": "STILL",
    "heart_rate": 72,
    "stress_level": "low"
  },
  "environment": {
    "location_label": "Home",
    "wifi_ssid": "MyHomeWiFi",
    "ambient_noise_db": 45
  },
  "device": {
    "battery": 85,
    "screen_on": false
  }
}
```

## 3. 关键实现路径

### 3.1 接入 Health Connect

这是 Android 统一健康数据中心。
1. 申请 `READ_HEART_RATE`, `READ_STEPS` 等权限。
2. 配置 Health Connect Client。
3. 定期 (每 15min) 聚合一次过去 15min 的统计值。

### 3.2 智能采样调度 (Smart Schedule)

- **Stationary Mode**: 当检测到 Activity=STILL 且 Screen=OFF，停止 GPS，仅保留 passive Wi-Fi 扫描。
- **Active Mode**: 当 Use=WALKING 或 Screen=ON，恢复正常采样 (1min/次)。

## 4. 与 Agent 联动

提供一个 Local HTTP Server (`NanoHTTPD`) 供 LifeVoice Recorder App 调用。
- `GET /context/current`: 返回当前最新的 JSON 快照。
- Recorder 在开始录音时调用此接口，将 Result 写入 metadata 文件。
